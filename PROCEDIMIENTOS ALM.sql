# INSERTAR EMPRESA

USE `workable`;
DROP procedure IF EXISTS `P_EMPRESA`;

DELIMITER $$
USE `workable`$$
CREATE PROCEDURE `P_EMPRESA` (
IN P_NOMB_EMPRESA VARCHAR(100),
IN P_DESCRIPCION_EMPR TEXT,
IN P_DIRECCION_EMPR VARCHAR(100),
IN P_CATEG_ID INT,
IN P_MUNI_ID INT
)
BEGIN
	INSERT INTO EMPRESA (NOMB_EMPRESA, DESCRIPCION_EMPR, DIRECCION_EMPR, CATEG_ID, MUNI_ID) 
    VALUES (P_NOMB_EMPRESA, P_DESCRIPCION_EMPR, P_DIRECCION_EMPR, P_CATEG_ID, P_MUNI_ID);
END$$

DELIMITER ;



# INSERTAR USUARIO

USE `workable`;
DROP procedure IF EXISTS `P_USUARIO`;

DELIMITER $$
USE `workable`$$
CREATE PROCEDURE `P_USUARIO` (
IN P_NOMBRE VARCHAR(50),
IN P_APELLIDO VARCHAR(50),
IN P_CLAVE VARCHAR(255),
IN P_DIRECCION VARCHAR(255),
IN P_CORREO VARCHAR(255),
IN P_USR_NAME VARCHAR(255),
IN P_TELEFONO INT,
IN P_FECHA_NACIMIENTO DATE,
IN P_FOTO_PERFIL BLOB,
IN P_GENR_ID BIT,
IN P_MUNI_ID INT,
IN P_EMPR_ID INT,
IN P_ROL_ID TINYINT,
IN P_ID_TIP_DOC INT
)

BEGIN
	DECLARE PWS VARCHAR(50) DEFAULT '12345';
    DECLARE CLAVE_ENC VARBINARY(500);
    SET CLAVE_ENC = AES_ENCRYPT(P_CLAVE, PWS);

	INSERT INTO USUARIO (NOMBRE, APELLIDO, CLAVE, DIRECCION, CORREO, USR_NAME, TELEFONO, FECHA_NACIMIENTO, FOTO_PERFIL, GENR_ID, MUNI_ID, EMPR_ID, ROL_ID, ID_TIP_DOC) 
    VALUES (P_NOMBRE, P_APELLIDO, CLAVE_ENC, P_DIRECCION, P_CORREO, P_USR_NAME, P_TELEFONO, P_FECHA_NACIMIENTO, P_FOTO_PERFIL, P_GENR_ID, P_MUNI_ID, P_EMPR_ID, P_ROL_ID, P_ID_TIP_DOC);
END$$

DELIMITER ;

# INSERTAR VALORACION

USE `workable`;
DROP procedure IF EXISTS `P_VALORACION`;

DELIMITER $$
USE `workable`$$
CREATE PROCEDURE `P_VALORACION` (
IN P_DESCRIPCION VARCHAR(255),
IN P_PUNTUACION FLOAT(2),
IN P_FECHA_VALR DATE,
IN P_EMPR_ID INT,
IN P_USR_ID INT
)

BEGIN
	IF P_PUNTUACION < 1 AND P_PUNTUACION >5 THEN
    SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT ='ERROR LA PUNTUACION DEBE SER ENTRE 1 Y 5';
    END IF;
    
	INSERT INTO VALORACION (DESCRIPCION, PUNTUACION, FECHA_VALR, EMPR_ID, USR_ID)
    VALUES (P_DESCRIPCION, P_PUNTUACION, CURDATE(), P_EMPR_ID, P_USR_ID);
END$$

DELIMITER ;



# INSERTAR DISCAPACIDAD DE USUARIO

USE `workable`;
DROP procedure IF EXISTS `P_INSERTAR_DISCAP`;

DELIMITER $$

CREATE PROCEDURE `P_INSERTAR_DISCAPACIDAD` (
IN P_USR_ID INT,
IN P_DISCAP_ID TINYINT
)
BEGIN
	INSERT IGNORE INTO USUARIO_DISCAP (USR_ID, DISCAP_ID)
	VALUES (P_USR_ID, P_DISCAP_ID);
END$$

DELIMITER ;



# INSERTAR INSTITUCION

USE `workable`;
DROP procedure IF EXISTS `P_INSTITUCION`;

DELIMITER $$

CREATE PROCEDURE `P_INSTITUCION` (
IN NOMBRE VARCHAR(255),
IN CIUDAD VARCHAR
)
BEGIN
	INSERT IGNORE INTO USUARIO_DISCAP (USR_ID, DISCAP_ID)
	VALUES (P_USR_ID, P_DISCAP_ID);
END$$

DELIMITER ;